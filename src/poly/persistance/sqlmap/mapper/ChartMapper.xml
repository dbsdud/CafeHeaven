<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="poly.persistance.mapper.ChartMapper">
<select id="getWeekGender" resultType="ChartDTO">
SELECT 
	TO_CHAR(O.ORD_DT_DATE,'YYYY-MM-DD') AS regDT, 
	NVL(M.COUNT,0) AS MALE_COUNT, 
	NVL(F.COUNT,0) AS FEMALE_COUNT
FROM
	CAFE_ORDER_INFO O 
	LEFT OUTER JOIN
	(
	SELECT 
		COUNT(OI.ORD_INFO_NO) AS count, 
		OI.ORD_DT_DATE AS ordDtDate
	FROM 
		CAFE_ORDER_INFO COI, 
		USER_CAFE UC 
	WHERE 
		COI.USER_NO = UC.USER_NO 
		AND 
		UC.GENDER = '남자' 
 	GROUP BY 
 		TO_CHAR(COI.ORD_DT_DATE,'YYYY-MM-DD'), 
 		UC.GENDER 
 	) 
 	M ON O.ORD_DT_DATE = M.ORD_DT_DATE
  	LEFT OUTER JOIN
	(
	SELECT 
		COUNT(COI.ORD_INFO_NO) AS count, 
		COI.ORD_DT_DATE AS ORD_DT_DATE 
	FROM 
		CAFE_ORDER_INFO COI, 
		USER_CAFE UC 
	WHERE 
		COI.USER_NO = UC.USER_NO 
		AND 
		UC.GENDER = '여자' 
  	 GROUP BY 
  	 	TO_CHAR(COI.ORD_DT_DATE,'YYYY-MM-DD'), 
  	 	UC.GENDER
  	 ) 
  	 F ON O.ORD_DT_DATE = F.ORD_DT_DATE
GROUP BY 
	TO_CHAR(O.ORD_DT_DATE,'YYYY-MM-DD')
</select>
</mapper>