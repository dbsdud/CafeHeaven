<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="poly.persistance.mapper.ChartMapper">
<select id="getWeekGender" resultType="ChartDTO">
SELECT 
	DATE_FORMAT(O.ORD_DT,'%Y-%m-%d') AS REG_DT, NVL(M.COUNT,0) AS MALE_COUNT, NVL(F.COUNT,0) AS FEMALE_COUNT
FROM
	CAFE_ORDER_INFO O LEFT OUTER JOIN
 	 (SELECT COUNT(OI.ORD_NO) AS COUNT, OI.ORD_DT AS ORD_DT FROM ORDER_INFO OI, USER_INFO UI WHERE OI.USER_NO = UI.USER_NO AND UI.GENDER = '남자' 
 	 GROUP BY DATE_FORMAT(OI.ORD_DT,'%Y-%m-%d'), UI.GENDER ) M ON O.ORD_DT = M.ORD_DT
  	LEFT OUTER JOIN
  	 (SELECT COUNT(OI.ORD_NO) AS COUNT, OI.ORD_DT AS ORD_DT FROM ORDER_INFO OI, USER_INFO UI WHERE OI.USER_NO = UI.USER_NO AND UI.GENDER = '여자' 
  	 GROUP BY DATE_FORMAT(OI.ORD_DT,'%Y-%m-%d'), UI.GENDER) F ON O.ORD_DT = F.ORD_DT
GROUP BY DATE_FORMAT(O.ORD_DT,'%Y-%m-%d');
</select>
</mapper>